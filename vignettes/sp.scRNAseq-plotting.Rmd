---
title: "sp.scRNAseq Plotting Vignette"
author: "Jason T. Serviss and Martin Enge"
date: '`r Sys.Date()`'
output:
    html_document:
        theme: flatly
        toc: yes
vignette: >
    %\VignetteIndexEntry{ClusterSignificance Vignette} 
    %\VignetteEngine{knitr::rmarkdown} 
    %\usepackage[utf8]{inputenc}
    %\SweaveUTF8
---

```{r, eval = FALSE, echo = FALSE}
Markers defined by ksTest
A1: b1, h1, m4, r9
B1: q1
C1: b3, e10, g10, f7
D1: t2
```


```{r, message = FALSE}
packages <- c(
    "sp.scRNAseq",
    "printr",
    "ggthemes",
    "tidyverse",
    "tidygraph",
    "ggraph",
    "viridis"
)
purrr::walk(packages, library, character.only = TRUE)
rm(packages)
```

```{r}
s <- grepl("^s", colnames(testCounts))
cObjSng <- spCounts(testCounts[, s], testErcc[, s])
cObjMul <- spCounts(testCounts[, !s], testErcc[, !s])
uObj <- testUns
sObj <- testSwa
```

## spCounts

Plot markers.
```{r}
plotCountsMarkers(cObjSng, cObjMul, markers = c("s2", "j4"))
```

Plot cell number.
```{r}
plotCountsERCC(cObjSng, cObjMul)
```

Get the plotting data so you can make a custom plot.
```{r}
plotCountsMarkers(cObjSng, cObjMul, markers = c("s2", "j4")) %>%
  plotData() %>%
  head()

plotCountsERCC(cObjSng, cObjMul) %>%
  plotData() %>%
  head()
```

## spUnsupervised

Plot the clustering results.
```{r}
plotUnsupervisedClass(uObj, cObjSng)
```

Plot markers in different cell types.
```{r}
plotUnsupervisedMarkers(uObj, cObjSng, markers = c("b1", "q1", "b3", "t2"))
```

Plot mean of multiple markers for the same cell type.
```{r, message = FALSE}
#use the data instead
plotUnsupervisedMarkers(uObj, cObjSng, markers = c("b1", "h1", "m4", "r9")) %>%
  plotData() %>%
  gather(gene, value, -(Sample:Colour)) %>%
  group_by(Sample) %>%
  mutate(`Mean(markers)` = mean(value)) %>%
  select(`t-SNE dim 1`, `t-SNE dim 2`, `Mean(markers)`) %>%
  distinct() %>%
  ggplot() +
  geom_point(aes(`t-SNE dim 1`, `t-SNE dim 2`, colour = `Mean(markers)`)) +
  viridis::scale_colour_viridis(option = "E") +
  theme_few() +
  theme(legend.position = "top", legend.title.align = 0) +
  guides(colour = guide_colourbar(title.position = "top")) 
```

Get the plotting data so you can make a custom plot.

```{r}
plotUnsupervisedClass(uObj, cObjSng) %>% 
  plotData() %>%
  head()

plotUnsupervisedMarkers(uObj, cObjSng, markers = c("b1", "q1", "b3", "t2")) %>% 
  plotData %>%
  head()
```

## spSwarm

### Graph-based plots

```{r}
plotSwarmGraph(sObj, uObj)
```

### Non-graph-based plots

Edge bar graph.
```{r}
plotSwarmEdgeBar(sObj)
```

P-value bar graph.
```{r}
plotSwarmPbar(sObj)
```

Heatmap.
```{r}
plotSwarmHeat(sObj)
```

Get data to make a custom plot.
```{r}
plotSwarmGraph(sObj, uObj) %>%
  plotData()

plotSwarmEdgeBar(sObj) %>%
  plotData() %>%
  head()
```

### Residual plots

