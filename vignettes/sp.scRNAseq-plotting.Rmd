---
title: "sp.scRNAseq Plotting Vignette"
author: "Jason T. Serviss and Martin Enge"
date: '`r Sys.Date()`'
output:
    html_document:
        theme: flatly
        toc: yes
vignette: >
    %\VignetteIndexEntry{ClusterSignificance Vignette} 
    %\VignetteEngine{knitr::rmarkdown} 
    %\usepackage[utf8]{inputenc}
    %\SweaveUTF8
---

```{r, eval = FALSE, echo = FALSE}
Markers defined by ksTest
A1: b1, h1, m4, r9
B1: q1
C1: b3, e10, g10, f7
D1: t2
```


```{r, message = FALSE}
packages <- c(
  "sp.scRNAseq", "printr", "ggthemes", "dplyr", 
  "tidyr", "ggplot2", "viridis"
)
purrr::walk(packages, library, character.only = TRUE)
rm(packages)
```

## spCounts

Plot markers.
```{r}
plotCountsMarkers(test_spCountsSng, test_spCountsMul, markers = c("CD74", "ANXA3"))
```

Plot cell number.
```{r}
plotCountsERCC(test_spCountsSng, test_spCountsMul)
```

Get the plotting data so you can make a custom plot.
```{r}
plotCountsMarkers(test_spCountsSng, test_spCountsMul, markers = c("CD74", "ANXA3")) %>%
  plotData() %>%
  head()

plotCountsERCC(test_spCountsSng, test_spCountsMul) %>%
  plotData() %>%
  head()
```

## spUnsupervised

Plot the clustering results.
```{r}
plotUnsupervisedClass(test_spUnsupervised, test_spCountsSng)
```

Plot markers in different cell types.
```{r}
plotUnsupervisedMarkers(test_spUnsupervised, test_spCountsSng, markers = c("CD74", "ANXA3", "ACTG2"))
```

Plot mean of multiple markers for the same cell type.
```{r, message = FALSE, eval = FALSE}
#need to find appropriate genes to plot here

#use the data instead
plotUnsupervisedMarkers(test_spUnsupervised, test_spCountsSng, markers = c("b1", "h1", "m4", "r9")) %>%
  plotData() %>%
  gather(gene, value, -(Sample:Colour)) %>%
  group_by(Sample) %>%
  mutate(`Mean(markers)` = mean(value)) %>%
  select(`t-SNE dim 1`, `t-SNE dim 2`, `Mean(markers)`) %>%
  distinct() %>%
  ggplot() +
  geom_point(aes(`t-SNE dim 1`, `t-SNE dim 2`, colour = `Mean(markers)`)) +
  viridis::scale_colour_viridis(option = "E") +
  theme_few() +
  theme(legend.position = "top", legend.title.align = 0) +
  guides(colour = guide_colourbar(title.position = "top")) 
```

Get the plotting data so you can make a custom plot.

```{r}
plotUnsupervisedClass(test_spUnsupervised, test_spCountsSng) %>% 
  plotData() %>%
  head()

plotUnsupervisedMarkers(test_spUnsupervised, test_spCountsSng, markers = c("CD74", "ANXA3", "ACTG2")) %>% 
  plotData %>%
  head()
```

## spSwarm

### Graph-based plots

```{r}
plotSwarmGraph(test_spSwarm, test_spUnsupervised)
```

### Non-graph-based plots

Edge bar graph.
```{r}
plotSwarmEdgeBar(test_spSwarm)
```

P-value bar graph.
```{r}
plotSwarmPbar(test_spSwarm)
```

Heatmap.
```{r}
plotSwarmHeat(test_spSwarm)
```

Get data to make a custom plot.
```{r}
plotSwarmGraph(test_spSwarm, test_spUnsupervised) %>%
  plotData()

plotSwarmEdgeBar(test_spSwarm) %>%
  plotData() %>%
  head()
```

### Residual plots

